<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enspider - Website Accessibility Monitor</title>
  <link rel="stylesheet" href="/styles.css?v=2">
</head>
<body>
  <header>
    <div class="header-content">
      <h1>ğŸ•·ï¸ Enspider</h1>
      <p class="subtitle">Website Accessibility Monitor</p>
      <nav class="header-nav">
        <a href="/tests" class="nav-link active" data-page="tests">Tests</a>
        <a href="/scheduled" class="nav-link" data-page="scheduled">Scheduled Tasks</a>
      </nav>
    </div>
    <div class="header-actions">
      <button id="configBtn" class="btn btn-secondary">âš™ï¸ Config</button>
      <button id="startScanBtn" class="btn btn-primary">ğŸš€ New Scan</button>
      <button id="refreshBtn" class="btn btn-secondary">ğŸ”„ Refresh</button>
      <button id="deleteAllBtn" class="btn btn-danger">ğŸ—‘ï¸ Delete All</button>
    </div>
  </header>

  <!-- Notifications Container -->
  <div id="notificationsContainer" class="notifications-container"></div>

  <main>
    <!-- Scan Progress Modal -->
    <div id="progressModal" class="modal">
      <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
          <h2>Scan in Progress</h2>
          <button class="close-btn" onclick="closeProgressModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div id="progressContent">
            <p id="progressDomain" style="font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;"></p>

            <div class="progress-bar-container">
              <div class="progress-bar">
                <div id="progressBarFill" class="progress-bar-fill"></div>
              </div>
              <span id="progressPercent" class="progress-percent">0%</span>
            </div>

            <div id="progressDetails" style="margin-top: 1.5rem;">
              <div id="progressStep" style="font-weight: 600; margin-bottom: 0.5rem;"></div>
              <div id="progressCurrentPage" style="color: #718096; font-size: 0.9rem; margin-bottom: 0.5rem;"></div>
              <div id="progressPageInfo" style="display: none; color: #4a5568; font-size: 0.875rem; padding: 0.5rem; background: #f7fafc; border-radius: 6px; margin-bottom: 0.5rem;"></div>
              <div id="progressScreenshotInfo" style="display: flex; gap: 0.5rem; margin-top: 0.5rem;"></div>
            </div>

            <div id="progressStats" style="margin-top: 1.5rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
              <div style="text-align: center;">
                <div id="progressPages" style="font-size: 1.5rem; font-weight: bold; color: #667eea;">0/0</div>
                <div style="font-size: 0.75rem; color: #718096;">Pages</div>
              </div>
              <div style="text-align: center;">
                <div id="progressIssues" style="font-size: 1.5rem; font-weight: bold; color: #e53e3e;">0</div>
                <div style="font-size: 0.75rem; color: #718096;">Issues</div>
              </div>
              <div style="text-align: center;">
                <div id="progressTime" style="font-size: 1.5rem; font-weight: bold; color: #38a169;">0s</div>
                <div style="font-size: 0.75rem; color: #718096;">Time</div>
              </div>
            </div>

            <!-- Logs Section -->
            <div style="margin-top: 1.5rem;">
              <h4 style="font-size: 0.875rem; font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">ğŸ“‹ Server Logs</h4>
              <div id="progressLogs" style="background: #1a202c; color: #a0aec0; padding: 1rem; border-radius: 8px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.75rem; max-height: 400px; overflow-y: auto; line-height: 1.5;">
                <div class="log-entry">Waiting for logs...</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scan Modal -->
    <div id="scanModal" class="modal">
      <div class="modal-content modal-content-scan">
        <div class="modal-header">
          <h2>ğŸš€ Start New Scan</h2>
          <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <!-- Domain Selection Section -->
          <div class="scan-section">
            <div class="scan-section-header">
              <span class="scan-section-icon">ğŸŒ</span>
              <h3>Select Domains to Test</h3>
            </div>
            <div class="domain-grid">
              <label class="domain-checkbox-label">
                <input type="checkbox" class="domain-checkbox" value="en" checked>
                <span class="domain-code">EN</span>
                <span class="domain-name">English</span>
              </label>
              <label class="domain-checkbox-label">
                <input type="checkbox" class="domain-checkbox" value="ar" checked>
                <span class="domain-code">AR</span>
                <span class="domain-name">Arabic</span>
              </label>
              <label class="domain-checkbox-label">
                <input type="checkbox" class="domain-checkbox" value="fr" checked>
                <span class="domain-code">FR</span>
                <span class="domain-name">French</span>
              </label>
              <label class="domain-checkbox-label">
                <input type="checkbox" class="domain-checkbox" value="ru" checked>
                <span class="domain-code">RU</span>
                <span class="domain-name">Russian</span>
              </label>
              <label class="domain-checkbox-label">
                <input type="checkbox" class="domain-checkbox" value="es">
                <span class="domain-code">ES</span>
                <span class="domain-name">Spanish</span>
              </label>
            </div>
          </div>

          <!-- Info Cards -->
          <div class="scan-info-cards">
            <div class="scan-info-card">
              <div class="scan-info-card-icon">ğŸ”„</div>
              <div class="scan-info-card-content">
                <h4>Multi-Domain Strategy</h4>
                <p>Pages from <strong>en.guazi.com</strong> will be tested across all selected domains by replacing the subdomain.</p>
              </div>
            </div>

            <div class="scan-info-card">
              <div class="scan-info-card-icon">ğŸ”—</div>
              <div class="scan-info-card-content">
                <h4>Custom URLs</h4>
                <p>URLs from <strong>âš™ï¸ Config</strong> are included automatically. <a href="#" onclick="openConfigModal(); return false;">Configure now</a></p>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="scan-actions">
            <button class="btn btn-secondary" onclick="closeScanModal()">Cancel</button>
            <button id="confirmScanBtn" class="btn btn-primary btn-large">Start Scan</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scheduled Task Modal -->
    <div id="scheduledTaskModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="scheduledTaskModalTitle">Add Scheduled Task</h2>
          <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <form id="scheduledTaskForm" style="display: flex; flex-direction: column; gap: 1rem;">
            <div>
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Task Name:</label>
              <input type="text" id="taskName" required placeholder="e.g., Daily scan for en.guazi.com" style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 4px;">
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Domain:</label>
              <select id="taskDomain" required style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 4px;">
                <option value="">Select a domain</option>
                <option value="en.guazi.com">en.guazi.com</option>
                <option value="ar.guazi.com">ar.guazi.com</option>
                <option value="fr.guazi.com">fr.guazi.com</option>
                <option value="ru.guazi.com">ru.guazi.com</option>
                <option value="es.guazi.com">es.guazi.com</option>
              </select>
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Schedule (Crontab):</label>
              <input type="text" id="taskCron" required placeholder="* * * * *" style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 4px; font-family: monospace;">
              <small style="color: #718096; display: block; margin-top: 0.25rem;">Format: minute hour day month weekday (e.g., 0 2 * * * for daily at 2 AM)</small>
              <div id="cronExplanation" style="margin-top: 0.5rem; padding: 0.75rem; background: #f7fafc; border-radius: 6px; font-size: 0.875rem; display: none;">
                <div style="color: #4a5568; margin-bottom: 0.25rem;">ğŸ’¡ <strong>Schedule:</strong> <span id="cronExplanationText"></span></div>
                <div style="color: #667eea; font-weight: 500;">â° <span id="cronNextRun"></span></div>
              </div>
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Quick Select:</label>
              <select id="taskCronPreset" style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 4px;">
                <option value="">Custom...</option>
                <option value="0 * * * *">Every hour</option>
                <option value="0 0 * * *">Every day at midnight</option>
                <option value="0 2 * * *">Every day at 2 AM</option>
                <option value="0 9 * * 1-5">Every weekday at 9 AM</option>
                <option value="0 9 * * 1">Every Monday at 9 AM</option>
                <option value="0 0 1 * *">Monthly on 1st at midnight</option>
              </select>
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Status:</label>
              <label style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="checkbox" id="taskEnabled" checked>
                <span>Enabled</span>
              </label>
            </div>
            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
              <button type="submit" class="btn btn-primary">Save Task</button>
              <button type="button" class="btn btn-secondary" onclick="closeScheduledTaskModal()">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Test History -->
    <section id="testHistoryPage" class="test-history">
      <h2>Test History</h2>
      <div class="test-history-filters" style="margin-bottom: 1.5rem; display: flex; gap: 1rem; align-items: center;">
        <label style="font-weight: 600;">Filter by status:</label>
        <select id="testStatusFilter" style="padding: 0.5rem 1rem; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 1rem;">
          <option value="all">All</option>
          <option value="running">Running</option>
          <option value="completed">Completed</option>
          <option value="failed">Failed</option>
        </select>
        <label style="margin-left: 1rem; font-weight: 600;">Filter by issues:</label>
        <select id="testIssueFilter" style="padding: 0.5rem 1rem; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 1rem;">
          <option value="all">All</option>
          <option value="has-issues">Has Issues Only</option>
        </select>
      </div>
      <div id="testList" class="test-list">Loading tests...</div>
    </section>

    <!-- Test Details -->
    <section id="testDetails" class="test-details" style="display: none;">
      <div class="details-header">
        <h2>Test Results</h2>
        <div style="display: flex; gap: 1rem;">
          <button id="deleteTestBtn" class="btn btn-danger" style="background: #e53e3e; border-color: #e53e3e;">ğŸ—‘ï¸ Delete Test</button>
          <button id="backBtn" class="btn btn-secondary">â† Back to List</button>
        </div>
      </div>

      <div class="summary">
        <div class="summary-card">
          <h3>Summary</h3>
          <div class="summary-stats">
            <div class="stat">
              <span class="stat-label">Pages Tested:</span>
              <span id="totalPages" class="stat-value">0</span>
            </div>
            <div class="stat">
              <span class="stat-label">Issues Found:</span>
              <span id="totalIssues" class="stat-value error">0</span>
            </div>
            <div class="stat">
              <span class="stat-label">Categories:</span>
              <span id="categories" class="stat-value">0</span>
            </div>
            <div class="stat">
              <span class="stat-label">Duration:</span>
              <span id="duration" class="stat-value">0s</span>
            </div>
          </div>
        </div>
      </div>

      <div class="filter-section">
        <label>Filter by page type:</label>
        <select id="pageTypeFilter">
          <option value="all">All</option>
          <option value="homepage">Homepage</option>
          <option value="detail">Detail Pages</option>
          <option value="list">List Pages</option>
          <option value="other">Other</option>
        </select>
        <label style="margin-left: 1rem;">Filter by issues:</label>
        <select id="issueFilter">
          <option value="all">All</option>
          <option value="has-issues">Has Issues Only</option>
        </select>
      </div>

      <div id="pageResults" class="page-results"></div>
    </section>

    <!-- Global Config Modal -->
    <div id="configModal" class="modal">
      <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
          <h2>âš™ï¸ Global Configuration</h2>
          <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <form id="configForm" style="display: flex; flex-direction: column; gap: 1.5rem;">
            <div>
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Custom URLs</label>
              <textarea id="configCustomUrls" placeholder="Enter custom URLs to test (one per line)&#10;Example:&#10;/products/123&#10;/used-cars/bmw-3-series" style="width: 100%; min-height: 200px; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem; font-family: monospace; line-height: 1.6;"></textarea>
              <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                <small style="color: #718096; flex: 1;">ğŸ’¡ These URLs will be automatically included in ALL scans (manual and scheduled).</small>
              </div>
              <small style="color: #48bb78; font-weight: 600;">âœ“ Not subject to the 10-page limit - all custom URLs will be tested</small>
            </div>
            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
              <button type="submit" class="btn btn-primary">ğŸ’¾ Save Configuration</button>
              <button type="button" class="btn btn-secondary" onclick="closeConfigModal()">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Cleanup Policy Modal -->
    <div id="cleanupModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ğŸ§¹ Data Cleanup Policy</h2>
          <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <form id="cleanupForm" style="display: flex; flex-direction: column; gap: 1.5rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <input type="checkbox" id="cleanupEnabled" style="width: auto;">
              <label for="cleanupEnabled" style="margin: 0; font-weight: 600;">Enable automatic cleanup</label>
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Retention Period (days)</label>
              <input type="number" id="cleanupRetainDaysInput" min="1" max="365" style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 4px;">
              <small style="color: #718096;">Tests older than this will be automatically deleted</small>
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Maximum Tests to Keep</label>
              <input type="number" id="cleanupMaxTestsInput" min="1" max="1000" style="width: 100%; padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 4px;">
              <small style="color: #718096;">Only the most recent N tests will be kept</small>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <input type="checkbox" id="cleanupArchive" style="width: auto;">
              <label for="cleanupArchive" style="margin: 0;">Archive data before deletion</label>
            </div>
            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
              <button type="submit" class="btn btn-primary">ğŸ’¾ Save Policy</button>
              <button type="button" class="btn btn-secondary" onclick="closeCleanupModal()">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Scheduled Tasks Page -->
    <section id="scheduledTasksPage" class="scheduled-tasks-page" style="display: none;">
      <div class="details-header">
        <h2>Scheduled Tasks</h2>
        <button id="addScheduledTaskBtn" class="btn btn-primary">+ Add Task</button>
      </div>

      <div id="scheduledTasksList" class="scheduled-tasks-list">Loading...</div>
    </section>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox">
    <span class="lightbox-close">&times;</span>
    <img class="lightbox-content" src="" alt="Screenshot">
    <div class="lightbox-info"></div>
  </div>

  <script src="/app.js?v=3" defer></script>
</body>
</html>
